/* empty css             *//* empty css                  *//* empty css                   *//* empty css                        *//* empty css                  *//* empty css                      *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                *//* empty css                     */import{Y as k,d as h,r as p,a as ee,Z as le,c as te,o as ae,b as l,w as t,h as oe,k as re,l as se,a5 as _,i as s,p as ne,q as f,X as ie,$ as de,a0 as ue,a1 as pe,a2 as me,a8 as fe,j as $,a9 as ce,a3 as ge,F as ve,I as A,a7 as N,_ as _e}from"./index-BoODYjlk.js";import{u as ye}from"./setting-CquutHMQ.js";/* empty css                   */const be=(i,n,g)=>k.get(`/admin/acl/role/${i}/${n}/?roleName=${g}`),ke=i=>i.id?k.put("/admin/acl/role/update",i):k.post("/admin/acl/role/save",i),we=i=>k.get("/admin/acl/permission/toAssign/"+i),Ce=(i,n)=>k.post(`/admin/acl/permission/doAssign/?roleId=${i}&permissionId=${n}`),xe=i=>k.delete("/admin/acl/role/remove/"+i),Ve={style:{flex:"auto"}},Ee=h({__name:"index",setup(i){let n=p(1),g=p(10),z=ye(),m=p(!1),d=ee({roleName:""});le(()=>{y()});let v=p(""),x=p([]),R=p(0),C=p(),c=p(!1),V=p([]),I=p([]),E=p();const y=async(o=1)=>{n.value=o;let e=await be(n.value,g.value,v.value);e.code===200&&(R.value=e.data.total,x.value=e.data.records)},T=()=>{y()},j=()=>{y(),v.value=""},O=()=>{z.refresh=!z.refresh},F=()=>{m.value=!0,Object.assign(d,{roleName:"",id:0}),A(()=>{C.value.clearValidate("roleName")})},B=o=>{m.value=!0,Object.assign(d,o),A(()=>{C.value.clearValidate("roleName")})},D={roleName:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=2?r():r(new Error("职位名称至少两位"))}}]},H=async()=>{await C.value.validate(),(await ke(d)).code===200&&(N({type:"success",message:d.id?"更新成功":"添加成功"}),m.value=!1,y(d.id?n.value:1))},L=async o=>{c.value=!0,Object.assign(d,o);let e=await we(d.id);e.code===200&&(V.value=e.data,I.value=q(V.value,[]))},M={children:"children",label:"name"},q=(o,e)=>(Array.isArray(o)&&o.forEach(r=>{r.select&&r.level===4&&e.push(r.id),r.children&&r.children.length>0&&q(r.children,e)}),e),K=async()=>{const o=d.id;let e=E.value.getCheckedKeys(),r=E.value.getHalfCheckedKeys(),w=e.concat(r);(await Ce(o,w)).code===200&&(c.value=!1,N({type:"success",message:"分配权限成功"}),window.location.reload())},X=async o=>{(await xe(o)).code===200&&(N({type:"success",message:"删除成功"}),y(x.value.length>1?n.value:n.value-1))};return(o,e)=>{const r=se,w=re,u=ne,P=oe,S=ie,b=ue,Y=pe,Z=de,G=me,J=fe,Q=ce,W=ge;return ae(),te(ve,null,[l(S,{style:{height:"80px"}},{default:t(()=>[l(P,{inline:!0,class:"form"},{default:t(()=>[l(w,{label:"职位搜索"},{default:t(()=>[l(r,{placeholder:"请你输入搜索职位的关键字",modelValue:s(v),"onUpdate:modelValue":e[0]||(e[0]=a=>_(v)?v.value=a:v=a)},null,8,["modelValue"])]),_:1}),l(w,null,{default:t(()=>[l(u,{type:"primary",size:"default",disabled:!s(v),onClick:j},{default:t(()=>e[8]||(e[8]=[f(" 搜索 ")])),_:1},8,["disabled"]),l(u,{size:"default",onClick:O},{default:t(()=>e[9]||(e[9]=[f("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(S,{style:{margin:"10px 0"}},{default:t(()=>[l(u,{type:"primary",size:"default",icon:"Plus",onClick:F},{default:t(()=>e[10]||(e[10]=[f(" 添加职位 ")])),_:1}),l(Z,{border:"",style:{margin:"10px 0"},data:s(x)},{default:t(()=>[l(b,{type:"index",align:"center",label:"#"}),l(b,{label:"ID",align:"center",prop:"id"}),l(b,{label:"职位名称",align:"center","show-overflow-tooltip":"",prop:"roleName"}),l(b,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(b,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(b,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:ze})=>[l(u,{size:"small",icon:"User",onClick:U=>L(a)},{default:t(()=>e[11]||(e[11]=[f(" 分配权限 ")])),_:2},1032,["onClick"]),l(u,{type:"primary",size:"small",icon:"Edit",onClick:U=>B(a)},{default:t(()=>e[12]||(e[12]=[f(" 编辑 ")])),_:2},1032,["onClick"]),l(Y,{title:`你确定要删除${a.rowName}?`,width:"260px",onConfirm:U=>X(a.id)},{reference:t(()=>[l(u,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>e[13]||(e[13]=[f(" 删除 ")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(G,{"current-page":s(n),"onUpdate:currentPage":e[1]||(e[1]=a=>_(n)?n.value=a:n=a),"page-size":s(g),"onUpdate:pageSize":e[2]||(e[2]=a=>_(g)?g.value=a:g=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper , ->, sizes, total, ",total:s(R),onCurrentChange:y,onSizeChange:T},null,8,["current-page","page-size","total"])]),_:1}),l(J,{modelValue:s(m),"onUpdate:modelValue":e[5]||(e[5]=a=>_(m)?m.value=a:m=a),title:s(d).id?"更新职位":"添加职位"},{footer:t(()=>[l(u,{size:"default",onClick:e[4]||(e[4]=a=>_(m)?m.value=!1:m=!1)},{default:t(()=>e[14]||(e[14]=[f("取消")])),_:1}),l(u,{type:"primary",size:"default",onClick:H},{default:t(()=>e[15]||(e[15]=[f("确定")])),_:1})]),default:t(()=>[l(P,{model:s(d),rules:D,ref_key:"form",ref:C},{default:t(()=>[l(w,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(r,{placeholder:"请你输入职位名称",modelValue:s(d).roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>s(d).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:s(c),"onUpdate:modelValue":e[7]||(e[7]=a=>_(c)?c.value=a:c=a)},{header:t(()=>e[16]||(e[16]=[$("h4",null,"分配菜单与按钮的权限",-1)])),default:t(()=>[l(Q,{ref_key:"tree",ref:E,data:s(V),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":s(I),props:M},null,8,["data","default-checked-keys"])]),footer:t(()=>[$("div",Ve,[l(u,{onClick:e[6]||(e[6]=a=>_(c)?c.value=!1:c=!1)},{default:t(()=>e[17]||(e[17]=[f("取消")])),_:1}),l(u,{type:"primary",onClick:K},{default:t(()=>e[18]||(e[18]=[f("确定")])),_:1})])]),_:1},8,["modelValue"])],64)}}}),He=_e(Ee,[["__scopeId","data-v-b4e2e0b2"]]);export{He as default};
