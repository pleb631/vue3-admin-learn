/* empty css             *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                *//* empty css                     */import{Y as w,d as se,r as u,a as ue,Z as de,c as O,o as N,b as l,w as a,h as ie,k as me,l as pe,p as fe,q as d,X as ve,$ as ge,a0 as ce,a1 as ye,a2 as we,j as R,a3 as be,a4 as Ve,i as q,a5 as D,a6 as Ce,F,y as _e,A as ke,x as Ue,a7 as _,I as B}from"./index-CKs84txs.js";import{u as xe}from"./setting-DKRhP1B1.js";const Ee=(s,k,S)=>w.get(`/admin/acl/user/${s}/${k}?username=${S}`),ze=s=>s.id?w.put("/admin/acl/user/update",s):w.post("/admin/acl/user/save",s),Re=s=>w.delete("/admin/acl/user/remove/"+s),qe=s=>w.get("/admin/acl/user/toAssign/"+s),Se=s=>w.post("/admin/acl/user/doAssignRole",s),Ae=s=>w.delete("/admin/acl/user/batchRemove",{data:s}),Ie={style:{flex:"auto"}},Ne={style:{flex:"auto"}},Ze=se({__name:"index",setup(s){let k=xe();const S=()=>{k.refresh=!k.refresh},$=u(0),m=u(1),A=u(5),f=u(!1),b=u(!1),v=u(),U=u("");let V=u(!1),I=u(!0),C=u([]),g=u([]),P=u([]);const n=ue({username:"",name:"",password:""}),x=u([]);de(()=>{c()});const c=async(o=1)=>{m.value=o;let e=await Ee(m.value,A.value,U.value);e.code==200&&($.value=e.data.total,x.value=e.data.records)},M=()=>{c()},h=()=>{c(),U.value=""},G=async()=>{let o=P.value.map(r=>r.id);(await Ae(o)).code==200&&(_({type:"success",message:"删除成功"}),c(x.value.length>1?m.value:m.value-1))},H=()=>{f.value=!0,Object.assign(n,{id:0,username:"",name:"",password:""}),B(()=>{v.value.clearValidate("username"),v.value.clearValidate("name"),v.value.clearValidate("password")})},X=()=>{f.value=!1},Y=async()=>{const o=await v.value.validate();console.log(o),(await ze(n)).code==200?(f.value=!1,_({type:"success",message:n.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,_({type:"error",message:n.id?"更新失败":"添加失败"}))},Z={username:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=5?r():r(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,r)=>{e.trim().length>=6?r():r(new Error("用户密码至少六位"))}}]},J=o=>{f.value=!0,Object.assign(n,o),B(()=>{v.value.clearValidate("username"),v.value.clearValidate("name")})},K=async o=>{(await Re(o)).code==200&&(_({type:"success",message:"删除成功"}),c(x.value.length>1?m.value:m.value-1))},Q=async o=>{Object.assign(n,o);let e=await qe(n.id);e.code==200&&(C.value=e.data.allRolesList,g.value=e.data.assignRoles,b.value=!0)},W=o=>{g.value=o?C.value:[],I.value=!1},ee=o=>{V.value=o.length===C.value.length,I.value=o.length!==C.value.length},le=async()=>{let o={userId:n.id,roleIdList:g.value.map(r=>r.id)};(await Se(o)).code==200&&(_({type:"success",message:"分配职务成功"}),b.value=!1,c(m.value))},ae=o=>{P.value=o};return(o,e)=>{const r=pe,y=me,i=fe,E=ie,T=ve,p=ce,te=ye,oe=ge,re=we,j=be,L=Ve,ne=Ce;return N(),O(F,null,[l(T,{style:{height:"80px"}},{default:a(()=>[l(E,{inline:!0,class:"form"},{default:a(()=>[l(y,{label:"用户名:"},{default:a(()=>[l(r,{placeholder:"请你输入搜索用户名",modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=t=>U.value=t)},null,8,["modelValue"])]),_:1}),l(y,null,{default:a(()=>[l(i,{type:"primary",size:"default",onClick:h},{default:a(()=>e[12]||(e[12]=[d("搜索")])),_:1}),l(i,{type:"primary",size:"default",onClick:S},{default:a(()=>e[13]||(e[13]=[d("重置")])),_:1})]),_:1})]),_:1})]),_:1}),l(T,{style:{margin:"10px 0px"}},{default:a(()=>[l(i,{type:"primary",size:"default",onClick:H},{default:a(()=>e[14]||(e[14]=[d("添加用户")])),_:1}),l(i,{type:"primary",size:"default",onClick:G},{default:a(()=>e[15]||(e[15]=[d("批量删除")])),_:1}),l(oe,{style:{margin:"10px 0px"},border:"",data:x.value,onSelectionChange:ae},{default:a(()=>[l(p,{type:"selection",align:"center"}),l(p,{label:"#",align:"center",type:"index"}),l(p,{label:"ID",align:"center",prop:"id"}),l(p,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(p,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(p,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(p,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(p,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(p,{label:"操作",width:"300px",align:"center"},{default:a(({row:t})=>[l(i,{type:"primary",size:"small",icon:"User",onClick:z=>Q(t)},{default:a(()=>e[16]||(e[16]=[d("分配角色")])),_:2},1032,["onClick"]),l(i,{type:"success",size:"small",icon:"Edit",onClick:z=>J(t)},{default:a(()=>e[17]||(e[17]=[d("编辑")])),_:2},1032,["onClick"]),l(te,{title:`你确定要删除${t.username}?`,width:"260px",onConfirm:z=>K(t.id)},{reference:a(()=>[l(i,{type:"danger",size:"small",icon:"Delete"},{default:a(()=>e[18]||(e[18]=[d("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(re,{"current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=t=>m.value=t),"page-size":A.value,"onUpdate:pageSize":e[2]||(e[2]=t=>A.value=t),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:$.value,onCurrentChange:c,onSizeChange:M},null,8,["current-page","page-size","total"])]),_:1}),l(j,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t)},{header:a(()=>e[19]||(e[19]=[R("h4",null,"添加用户",-1)])),default:a(()=>[l(E,{model:n,rules:Z,ref_key:"formRef",ref:v},{default:a(()=>[l(y,{label:"用户姓名",prop:"name"},{default:a(()=>[l(r,{placeholder:"请您输入用户姓名",modelValue:n.username,"onUpdate:modelValue":e[3]||(e[3]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),l(y,{label:"用户昵称",prop:"username"},{default:a(()=>[l(r,{placeholder:"请您输入用户昵称",modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=t=>n.name=t)},null,8,["modelValue"])]),_:1}),l(y,{label:"用户密码",prop:"password"},{default:a(()=>[l(r,{placeholder:"请您输入用户密码",modelValue:n.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.password=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),footer:a(()=>[R("div",Ie,[l(i,{type:"primary",onClick:X},{default:a(()=>e[20]||(e[20]=[d("取消")])),_:1}),l(i,{type:"primary",onClick:Y},{default:a(()=>e[21]||(e[21]=[d("确定")])),_:1})])]),_:1},8,["modelValue"]),l(j,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=t=>b.value=t)},{header:a(()=>e[22]||(e[22]=[R("h4",null,"分配角色",-1)])),default:a(()=>[l(E,null,{default:a(()=>[l(y,{label:"用户姓名"},{default:a(()=>[l(r,{disabled:!0,modelValue:n.username,"onUpdate:modelValue":e[7]||(e[7]=t=>n.username=t)},null,8,["modelValue"])]),_:1})]),_:1}),l(E,null,{default:a(()=>[l(y,{label:"职位列表"},{default:a(()=>[l(L,{modelValue:q(V),"onUpdate:modelValue":e[8]||(e[8]=t=>D(V)?V.value=t:V=t),indeterminate:q(I),onChange:W},{default:a(()=>e[23]||(e[23]=[d("全选")])),_:1},8,["modelValue","indeterminate"]),l(ne,{modelValue:q(g),"onUpdate:modelValue":e[9]||(e[9]=t=>D(g)?g.value=t:g=t),onChange:ee},{default:a(()=>[(N(!0),O(F,null,_e(q(C),(t,z)=>(N(),ke(L,{key:z,label:t},{default:a(()=>[d(Ue(t.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:a(()=>[R("div",Ne,[l(i,{onClick:e[10]||(e[10]=t=>b.value=!1)},{default:a(()=>e[24]||(e[24]=[d("取消")])),_:1}),l(i,{type:"primary",onClick:le},{default:a(()=>e[25]||(e[25]=[d("确认")])),_:1})])]),_:1},8,["modelValue"])],64)}}});export{Ze as default};
