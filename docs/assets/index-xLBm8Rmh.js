/* empty css             *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                        *//* empty css                  *//* empty css                   *//* empty css                 */import{r as ye,u as Ae,_ as be,b as Ve}from"./index.vue_vue_type_script_setup_true_lang-DQznBIoA.js";import{Y as E,d as W,r as f,ae as ke,z as Ie,A as N,o as S,w as a,b as l,k as se,l as ue,i as t,af as re,c as q,F as K,y as H,ag as oe,ab as Ue,a5 as j,B as xe,a8 as de,j as Q,p as Z,q as B,$ as ee,a0 as le,ad as he,x as ie,h as pe,a7 as L,I as Ce,a as we,H as Pe,ac as Ne,Q as X,a1 as Le,a2 as ze,S as Y,X as $e}from"./index-BvNJim6d.js";/* empty css                     *//* empty css                    *//* empty css                   */const Ee=(b,k,I)=>E.get(`/admin/product/${b}/${k}?category3Id=${I}`),te=()=>E.get("/admin/product/baseTrademark/getTrademarkList"),me=b=>E.get("/admin/product/spuImageList/"+b),ce=b=>E.get("/admin/product/spuSaleAttrList/"+b),ne=()=>E.get("/admin/product/baseSaleAttrList"),De=b=>b.id?E.post("/admin/product/updateSpuInfo",b):E.post("/admin/product/saveSpuInfo",b),qe=b=>E.post("/admin/product/saveSkuInfo",b),Ke=b=>E.get("/admin/product/findBySpuId/"+b),Be=["src"],Te=W({__name:"spuForm",emits:["changeScene"],setup(b,{expose:k,emit:I}){let V=I,g=f("");const z=()=>{V("changeScene",{flag:0,params:"update"})};let w=f([]),y=f([]),A=f([]),s=f([]),U=f(!1),P=f(""),v=f({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),M=f([]);const R=async n=>{v.value=n;let e=await te(),o=await me(n.id),r=await ce(n.id),$=await ne();w.value=e.data,Array.isArray(o.data)?y.value=o.data.map(m=>({name:m.imgName,url:m.imgUrl})):y.value=[],Array.isArray(r.data)?A.value=r.data:A.value=[],Array.isArray($.data)?s.value=$.data:s.value=[]},x=n=>{!n||!n.url||(P.value=n.url,U.value=!0)},d=n=>{const e=y.value.findIndex(o=>o.url===n.url);e!==-1&&y.value.splice(e,1)},_=n=>n.type==="image/png"||n.type==="image/jpeg"||n.type==="image/gif"?n.size/1024/1024<3?!0:(L({type:"error",message:"上传文件务必小于3M"}),!1):(L({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let c=ke(()=>s.value.filter(e=>A.value.every(o=>e.name!==o.saleAttrName)));const p=()=>{const[n,e]=g.value.split(":");let o={baseSaleAttrId:n,saleAttrName:e,spuSaleAttrValueList:[]};A.value.push(o),g.value=""},i=(n,e)=>{n.flag=!0,n.saleAttrValue="",Ce(()=>{M.value[e].focus()})},T=n=>{const{baseSaleAttrId:e,saleAttrValue:o}=n;let r={baseSaleAttrId:e,saleAttrValueName:o};if((o==null?void 0:o.trim())===""){L({type:"error",message:"属性值不能为空的"});return}if(n.spuSaleAttrValueList.find(m=>m.saleAttrValueName===o)){L({type:"error",message:"属性值重复"});return}n.spuSaleAttrValueList.push(r),n.flag=!1},C=async()=>{v.value.spuImageList=y.value.map(e=>({imgName:e.name,imgUrl:e.response&&e.response.data||e.url})),v.value.spuSaleAttrList=A.value,(await De(v.value)).code===200&&(L({type:"success",message:v.value.id?"更新成功":"添加成功"}),V("changeScene",{flag:0,params:v.value.id?"update":"add"}))};return k({initHasSpuData:R,initAddSpu:async n=>{Object.assign(v.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),y.value=[],A.value=[],g.value="",v.value.category3Id=n;let e=await te(),o=await ne();w.value=e.data,s.value=o.data}}),(n,e)=>{const o=ue,r=se,$=oe,m=re,ae=Ie("Plus"),G=xe,fe=Ue,_e=de,O=Z,J=le,ge=he,ve=ee,Se=pe;return S(),N(Se,{"label-width":"100px"},{default:a(()=>[l(r,{label:"SPU名称"},{default:a(()=>[l(o,{placeholder:"请你输入SPU名称",modelValue:t(v).spuName,"onUpdate:modelValue":e[0]||(e[0]=u=>t(v).spuName=u)},null,8,["modelValue"])]),_:1}),l(r,{label:"SPU品牌"},{default:a(()=>[l(m,{modelValue:t(v).tmId,"onUpdate:modelValue":e[1]||(e[1]=u=>t(v).tmId=u)},{default:a(()=>[(S(!0),q(K,null,H(t(w),(u,F)=>(S(),N($,{label:u.tmName,value:u.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"SPU描述"},{default:a(()=>[l(o,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:t(v).description,"onUpdate:modelValue":e[2]||(e[2]=u=>t(v).description=u)},null,8,["modelValue"])]),_:1}),l(r,{label:"SPU图标"},{default:a(()=>[l(fe,{"file-list":t(y),"onUpdate:fileList":e[3]||(e[3]=u=>j(y)?y.value=u:y=u),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":x,"on-remove":d,"before-upload":_},{default:a(()=>[l(G,null,{default:a(()=>[l(ae)]),_:1})]),_:1},8,["file-list"]),l(_e,{modelValue:t(U),"onUpdate:modelValue":e[4]||(e[4]=u=>j(U)?U.value=u:U=u)},{default:a(()=>[Q("img",{"w-full":"",src:t(P),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Be)]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"SPU销售属性"},{default:a(()=>[l(m,{modelValue:t(g),"onUpdate:modelValue":e[5]||(e[5]=u=>j(g)?g.value=u:g=u),placeholder:t(c).length?`还未选择${t(c).length}个`:"暂无数据可选择"},{default:a(()=>[(S(!0),q(K,null,H(t(c),(u,F)=>(S(),N($,{label:u.name,key:u.id,value:`${u.id}:${u.name}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(O,{style:{"margin-left":"10px"},type:"primary",size:"default",icon:"Plus",disabled:!t(g),onClick:p},{default:a(()=>e[6]||(e[6]=[B(" 添加属性 ")])),_:1},8,["disabled"]),l(ve,{border:"",style:{margin:"10px 0"},data:t(A)},{default:a(()=>[l(J,{label:"序号",type:"index",align:"center",width:"80px"}),l(J,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),l(J,{label:"销售属性值"},{default:a(({row:u,$index:F})=>[(S(!0),q(K,null,H(u.spuSaleAttrValueList,(D,Re)=>(S(),N(ge,{key:u.id,class:"mx-1",closable:"",style:{margin:"0 8px"},onClose:je=>u.spuSaleAttrValueList.splice(F,1)},{default:a(()=>[B(ie(D.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.flag===!0?(S(),N(o,{key:0,ref:D=>t(M)[F]=D,modelValue:u.saleAttrValue,"onUpdate:modelValue":D=>u.saleAttrValue=D,placeholder:"请你输入属性值",size:"small",style:{width:"100px"},onBlur:D=>T(u)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(S(),N(O,{key:1,size:"small",icon:"Plus",onClick:D=>i(u,F)},null,8,["onClick"]))]),_:1}),l(J,{label:"操作",width:"120px"},{default:a(({row:u,$index:F})=>[l(O,{type:"danger",size:"small",icon:"Delete",onClick:D=>t(A).splice(F,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),l(r,null,{default:a(()=>[l(O,{type:"primary",size:"default",onClick:C,disabled:!(t(A).length>0)},{default:a(()=>e[7]||(e[7]=[B(" 保存 ")])),_:1},8,["disabled"]),l(O,{size:"default",onClick:z},{default:a(()=>e[8]||(e[8]=[B("取消")])),_:1})]),_:1})]),_:1})}}}),Fe=["src"],He=W({__name:"skuForm",emits:["changeScene"],setup(b,{expose:k,emit:I}){let V=I,g=f([]),z=f([]),w=f([]),y=f(),A=f(null),s=we({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});const U=()=>{V("changeScene",{flag:0,params:""})},P=async(x,d,_)=>{g.value=[],z.value=[],w.value=[],A.value=null,s.category3Id=_.category3Id,s.spuId=_.id,s.tmId=_.tmId,s.skuName="",s.price="",s.weight="",s.skuDesc="",s.skuAttrValueList=[],s.skuSaleAttrValueList=[],s.skuDefaultImg="";let c=await ye(x,d,_.category3Id),p=await ce(_.id),i=await me(_.id);Array.isArray(c.data)&&(g.value=c.data),Array.isArray(p.data)&&(z.value=p.data),Array.isArray(i.data)&&(w.value=i.data)},v=x=>{!Array.isArray(w.value)||!y.value||(A.value=x,s.skuDefaultImg=x.imgUrl)},M=x=>{if(x.length>0){const d=x[0];v(d)}},R=async()=>{s.skuAttrValueList=g.value.reduce((d,_)=>{if(_.attrIdAndValueId){let[c,p]=_.attrIdAndValueId.split(":");d.push({attrId:c,valueId:p})}return d},[]),s.skuSaleAttrValueList=z.value.reduce((d,_)=>{if(_.saleIdAndValueId){let[c,p]=_.saleIdAndValueId.split(":");d.push({saleAttrId:c,saleAttrValueId:p})}return d},[]),(await qe(s)).code===200?(L({type:"success",message:"添加SKU成功"}),V("changeScene",{flag:0,params:""})):L({type:"error",message:"添加SKU失败"})};return k({initSkuData:P}),(x,d)=>{const _=ue,c=se,p=oe,i=re,T=pe,C=le,h=Z,n=ee;return S(),N(T,{"label-width":"100px"},{default:a(()=>[l(c,{label:"SKU名称"},{default:a(()=>[l(_,{placeholder:"SKU名称",modelValue:t(s).skuName,"onUpdate:modelValue":d[0]||(d[0]=e=>t(s).skuName=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"价格(元)"},{default:a(()=>[l(_,{placeholder:"价格(元)",type:"number",modelValue:t(s).price,"onUpdate:modelValue":d[1]||(d[1]=e=>t(s).price=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"重量(g)"},{default:a(()=>[l(_,{placeholder:"重量(g)",type:"number",modelValue:t(s).weight,"onUpdate:modelValue":d[2]||(d[2]=e=>t(s).weight=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"SKU描述"},{default:a(()=>[l(_,{placeholder:"SKU描述",type:"textarea",modelValue:t(s).skuDesc,"onUpdate:modelValue":d[3]||(d[3]=e=>t(s).skuDesc=e)},null,8,["modelValue"])]),_:1}),l(c,{label:"平台属性"},{default:a(()=>[l(T,{inline:!0,"label-width":"100px"},{default:a(()=>[(S(!0),q(K,null,H(t(g),(e,o)=>(S(),N(c,{label:e.attrName,key:e.id},{default:a(()=>[l(i,{modelValue:e.attrIdAndValueId,"onUpdate:modelValue":r=>e.attrIdAndValueId=r},{default:a(()=>[(S(!0),q(K,null,H(e.attrValueList,(r,$)=>(S(),N(p,{value:`${e.id}:${r.id}`,label:r.valueName,key:r.id},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),l(c,{label:"销售属性"},{default:a(()=>[l(T,{inline:!0},{default:a(()=>[(S(!0),q(K,null,H(t(z),(e,o)=>(S(),N(c,{label:e.saleAttrName,key:e.id},{default:a(()=>[l(i,{modelValue:e.saleIdAndValueId,"onUpdate:modelValue":r=>e.saleIdAndValueId=r},{default:a(()=>[(S(!0),q(K,null,H(e.spuSaleAttrValueList,(r,$)=>(S(),N(p,{value:`${e.id}:${r.id}`,label:r.saleAttrValueName,key:r.id},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),l(c,{label:"图片名称"},{default:a(()=>[l(n,{border:"",data:t(w),ref_key:"table",ref:y,onSelectionChange:M},{default:a(()=>[l(C,{type:"selection",width:"80px",align:"center"}),l(C,{label:"图片"},{default:a(({row:e})=>[Q("img",{src:e.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Fe)]),_:1}),l(C,{label:"名称",prop:"imgName"}),l(C,{label:"操作"},{default:a(({row:e})=>{var o;return[l(h,{type:"primary",size:"small",onClick:r=>v(e),disabled:((o=t(A))==null?void 0:o.id)===e.id},{default:a(()=>{var r;return[B(ie(((r=t(A))==null?void 0:r.id)===e.id?"已设为默认":"设置默认"),1)]}),_:2},1032,["onClick","disabled"])]}),_:1})]),_:1},8,["data"])]),_:1}),l(c,null,{default:a(()=>[l(h,{type:"primary",size:"default",onClick:R},{default:a(()=>d[4]||(d[4]=[B("保存")])),_:1}),l(h,{size:"default",onClick:U},{default:a(()=>d[5]||(d[5]=[B("取消")])),_:1})]),_:1})]),_:1})}}}),Me=["src"],ul=W({__name:"index",setup(b){let k=Ae(),I=f(0),V=f(1),g=f(3),z=f([]),w=f(0),y=f(),A=f(),s=f([]),U=f(!1);Pe(()=>k.c3Id,()=>{k.c3Id&&P()});const P=async(p=1)=>{V.value=p;let i=await Ee(V.value,g.value,k.c3Id);i.code===200&&(z.value=i.data.records,w.value=i.data.total)},v=()=>{P()},M=()=>{I.value=1,y.value.initAddSpu(k.c3Id)},R=p=>{I.value=p.flag,p.params=="update"?P(V.value):P()},x=p=>{I.value=1,y.value.initHasSpuData(p)},d=p=>{I.value=2,A.value.initSkuData(k.c1Id,k.c2Id,p)},_=async p=>{try{let i=await Ke(p.id);i.code===200&&Array.isArray(i.data)?(s.value=i.data,U.value=!0):(s.value=[],L({type:"warning",message:"暂无SPU数据"}))}catch{s.value=[],L({type:"error",message:"获取SPU数据失败"})}},c=async p=>{(await Ve(p.id)).code===200?(L({type:"success",message:"删除成功"}),P(z.value.length>1?V.value:V.value-1)):L({type:"error",message:"删除失败"})};return Ne(()=>{k.$reset()}),(p,i)=>{const T=be,C=Z,h=le,n=Le,e=ee,o=ze,r=de,$=$e;return S(),q(K,null,[l(T,{scene:t(I)},null,8,["scene"]),l($,{style:{margin:"10px 0"}},{default:a(()=>[X(Q("div",null,[l(C,{type:"primary",size:"default",icon:"Plus",disabled:!t(k).c3Id,onClick:M},{default:a(()=>i[3]||(i[3]=[B(" 添加SPU ")])),_:1},8,["disabled"]),l(e,{style:{margin:"10px 0"},border:"",data:t(z)},{default:a(()=>[l(h,{label:"序号",align:"center",width:"80px",type:"index"}),l(h,{label:"SPU名称",prop:"spuName"}),l(h,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),l(h,{label:"SPU操作"},{default:a(({row:m,$index:ae})=>[l(C,{icon:"Plus",title:"添加SPU",size:"small",onClick:G=>d(m)},null,8,["onClick"]),l(C,{type:"primary",icon:"Edit",title:"修改SPU",size:"small",onClick:G=>x(m)},null,8,["onClick"]),l(C,{type:"info",icon:"View",title:"查看SPU列表",size:"small",onClick:G=>_(m)},null,8,["onClick"]),l(n,{title:`你确定删除${m.spuName}?`,width:"200px",onConfirm:G=>c(m)},{reference:a(()=>[l(C,{type:"danger",icon:"Delete",title:"删除SPU",size:"small"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(o,{"current-page":t(V),"onUpdate:currentPage":i[0]||(i[0]=m=>j(V)?V.value=m:V=m),"page-size":t(g),"onUpdate:pageSize":i[1]||(i[1]=m=>j(g)?g.value=m:g=m),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:t(w),onCurrentChange:P,onSizeChange:v},null,8,["current-page","page-size","total"])],512),[[Y,t(I)===0]]),X(l(Te,{ref_key:"spu",ref:y,onChangeScene:R},null,512),[[Y,t(I)===1]]),X(l(He,{ref_key:"sku",ref:A,onChangeScene:R},null,512),[[Y,t(I)===2]]),l(r,{modelValue:t(U),"onUpdate:modelValue":i[2]||(i[2]=m=>j(U)?U.value=m:U=m),title:"SKU列表"},{default:a(()=>[l(e,{data:t(s),border:""},{default:a(()=>[l(h,{label:"SKU名称",prop:"skuName"}),l(h,{label:"SKU价格",prop:"price"}),l(h,{label:"SKU重量",prop:"weight"}),l(h,{label:"SKU图片"},{default:a(({row:m})=>[Q("img",{src:m.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Me)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})],64)}}});export{ul as default};
